# 数舰 E-com System PRO - 系统架构与商业白皮书

## 引言

**数舰 (Data Warship)** 是一款面向未来的新一代电商智能运营系统。它并非传统意义上的BI报表工具，而是一个集**数据私有化治理**、**多维业务洞察**与**AI驱动决策**于一体的综合性作战指挥中心。

本系统旨在解决现代电商运营的核心痛点：数据源分散、关联分析困难、依赖人工经验、以及对AI能力的渴望与应用鸿沟。通过将先进的前端技术与强大的Google Gemini AI模型深度融合，“数舰”将数据转化为洞察，将洞察转化为行动，最终赋能企业实现可持续的、由数据智能驱动的业务增长。

### 项目仓库 (Project Repository)

- **GitHub**: [https://github.com/wutongweng2026/E-com-system-pro](https://github.com/wutongweng2026/E-com-system-pro)

---

## I. 系统哲学与核心架构 (System Philosophy & Core Architecture)

### 1. 系统哲学

- **数据即资产，私有化为先**：我们坚信，业务数据是企业的核心数字资产。因此，“数舰”采用完全基于客户端（浏览器）的架构，所有数据均存储于用户本地的`localStorage`中。**您的数据永远不会离开您的浏览器**，彻底解决了中小企业对公有云SaaS产品的数据安全顾虑。
- **万物皆可连接**：电商运营的复杂性源于数据维度的多样性。系统的核心任务是打破数据孤岛，将来自商智、广告、客服、产品主数据等不同源头的信息，在逻辑层面融为一体，实现真正的“多维查询”与“全景洞察”。
- **AI即服务，洞察即行动**：系统不仅仅是数据的呈现者，更是洞察的提炼者和行动的建议者。深度集成Google Gemini，将AI能力无缝注入到从“数据解读”到“内容创作”再到“策略建议”的每一个环节。

### 2. 核心架构

本系统采用创新的**三层客户端架构 (Three-Tier Client-Side Architecture)**：

  <!-- 概念图占位 -->

- **物理数据层 (Physical Data Layer)**
  - **职责**: 负责原始数据的接收、存储与版本管理。
  - **实现**: 利用浏览器`localStorage`作为轻量级的“私有数据仓库”。所有通过「数据中心」上传的Excel文件，经过解析后，被存储为JSON数组格式的“物理表”（如`fact_shangzhi`, `fact_jingzhuntong`）。
  - **优势**: 零服务器成本、极致的数据安全性与隐私性、离线可用。

- **逻辑模型层 (Logical Model Layer)**
  - **职责**: 系统的“数据大脑”。负责对物理数据进行清洗、标准化、关联和建模，将其转化为业务人员可以理解和使用的“逻辑模型”。
  - **实现**:
    - **表结构定义 (Schema Definitions)**: 位于`lib/schemas.ts`，为每种物理表定义了字段`key`、`label`、`type`和`tags`。这是系统理解原始数据的“契约”，也是实现高度可扩展性的基石。用户可在「数据体验」模块自定义此结构。
    - **维度表 (Dimension Tables)**: 如`dim_skus`, `dim_shops`等，存储核心业务实体的“主数据”（如SKU的成本价、店铺的经营模式）。
    - **辅助函数 (Helpers)**: 位于`lib/helpers.ts`，包含如`normalizeDate`（日期格式标准化）和`getSkuIdentifier`（多字段兼容SKU识别）等核心逻辑，确保了数据的一致性与鲁棒性。

- **应用与AI层 (Application & AI Layer)**
  - **职责**: 系统的“交互界面”与“智能核心”。负责将逻辑模型层处理好的数据，以可视化的方式呈现给用户，并通过AI模型提供增值服务。
  - **实现**:
    - **视图组件 (View Components)**: 位于`views/`目录，如`DashboardView`, `AIProfitAnalyticsView`等，是各个功能模块的用户界面。
    - **AI集成**: 在需要时，视图组件会根据当前上下文（如筛选后的数据、用户输入），动态构建Prompt，调用`@google/genai`库与Gemini API交互，并将返回结果解析、渲染。

---

## II. 核心数据结构 (Core Data Structures)

系统的数据结构设计借鉴了数据仓库理论中的**星型模型 (Star Schema)** 思想，由“事实表”和“维度表”构成。

- **事实表 (Fact Tables)**
  - **定义**: 存储业务流程中产生的、可度量的数据事件。通常包含大量行，并随时间不断增长。
  - **示例**:
    - `fact_shangzhi`: 存储每日每个SKU的销售表现数据（GMV、CA、PV、UV等）。
    - `fact_jingzhuntong`: 存储每日每个SKU或账户的广告投放数据（花费、点击、ROI等）。
  - **特点**: 以流水形式记录，包含指向维度表的外键（如`sku_code`）。

- **维度表 (Dimension Tables)**
  - **定义**: 存储对业务事实进行描述的“上下文”信息，即“谁、什么、哪里、何时”。数据相对稳定。
  - **示例**:
    - `dim_skus`: SKU主数据表，包含SKU的唯一编码、名称、**成本价**、品牌、类目、库存等静态属性。
    - `dim_shops`: 店铺主数据表，包含店铺ID、名称、经营模式等。
  - **作用**: 为事实表中的数据提供丰富的业务背景，是实现深度分析（如下钻、切片）的基础。例如，计算利润时，正是通过`fact_shangzhi`中的`sku_code`关联到`dim_skus`中的`costPrice`。

- **表结构定义 (Schema Definitions)**
  - **定义**: 描述物理数据（Excel列头）如何映射到系统内部字段（`key`）の元数据。
  - **示例**: 在`lib/schemas.ts`中，为“GMV”这个业务指标定义了`key: 'paid_amount'`，并提供了别名`tags: ['成交金额', 'GMV']`。
  - **价值**: 使得系统能够兼容不同来源、不同命名习惯的表格，用户只需在「数据体验」模块调整`tags`，即可让系统“认识”新的列名，实现了极高的灵活性和扩展性。

---

## III. 模块功能详解 (Detailed Module Functions)

### 核心分析 (Core Analytics)

- **AI驾驶舱 (`DashboardView`)**:
  - **定位**: 业务健康度的实时“心电图”。
  - **功能**:
    1. **核心KPI概览**: 动态展示自定义时间范围内的总GMV、总CA、广告花费、整体ROI，并提供与上一周期的环比分析。
    2. **核心指标趋势图**: 自由勾选核心指标，可视化其在选定周期内的每日变化趋势，便于多维度对比。
    3. **AI智能洞察**: Gemini驱动，自动分析当前数据，生成“核心业绩”、“增长亮点”和“潜在风险”的摘要报告。
    4. **业务排行**: 实时展示店铺GMV贡献排行和畅销SKU Top 5，快速定位核心业务单元。

- **多维查询 (`MultiQueryView`)**:
  - **定位**: 强大的Ad-hoc自助分析工具。
  - **功能**: 允许用户自由组合时间、店铺、SKU等维度，并勾选来自**商智**和**广告**两个数据源的任意指标，系统会自动将数据在SKU和日期层面进行聚合，生成交叉分析报表。

- **运营报表 (`ReportsView`)**:
  - **定位**: 自动化、规范化的报告中心。
  - **功能**: (当前为原型) 规划支持生成标准化的日报、周报、月报。用户可选择店铺、SKU清单，系统将自动拉取相应数据，并以结构化的表格呈现销售与广告的关键指标及其环比。

- **资产管理 (`SKUManagementView`)**:
  - **定位**: 系统的“主数据管理中心 (MDM)”。
  - **功能**: 提供对`SKU`、`店铺`、`客服`和`SKU清单`四类核心维度数据的增删改查及批量导入导出功能。此模块是保证所有分析准确性的数据基石。

### AI 洞察与决策 (AI Insight & Decision)

- **AI智能补货 (`AISmartReplenishmentView`)**:
  - **定位**: 智能库存预警与决策辅助。
  - **业务逻辑**: 基于商智数据，计算每个SKU过去7天和15天的实际销量，并与其当前受监控的库存（入仓/厂直）进行对比。若库存低于7日销量，则判定为“严重警告”；若低于15日销量，则为“补货警告”。

- **AI利润分析 (`AIProfitAnalyticsView`)**:
  - **定位**: SKU级的精细化盈利能力“显微镜”。
  - **业务逻辑**: 打通三大核心数据：
    1. 从`fact_shangzhi`获取**收入 (GMV)**。
    2. 通过SKU编码关联`dim_skus`，获取**货品成本 (COGS)**。
    3. 从`fact_jingzhuntong`获取该SKU的**广告分摊成本**。
    最终计算出每个SKU的**净利润**与**净利润率**，并提供AI诊断功能。

- **AI销售预测 (`AISalesForecastView`)**:
  - **定位**: 基于历史数据的未来销量“水晶球”。
  - **业务逻辑**: 用户选择SKU后，系统自动提取过去90天的历史销量，并结合用户输入的未来营销变量（如大促、推广），构建Prompt，由Gemini进行时序预测分析，返回未来每日的预测销量及分析洞察。

### AI 执行与创造 (AI Execution & Creation)

- **AI文案生成/广告图/客服助手/产品报价**:
  - **定位**: 赋能一线执行岗位的AI工具集。
  - **业务逻辑**: 这些模块均遵循“场景化数据 + 用户需求 -> AI处理”的模式。例如，「AI文案生成」会将选定SKU的各项参数与用户的文案要求（如风格、卖点）结合，生成高质量的商品描述。

### 数据工程 (Data Engineering)

- **数据中心 (`DataCenterView`)**:
  - **定位**: 系统的数据“入口”与“海关”。
  - **功能**:
    1. **智能识别**: 上传文件时，系统会通过`detectTableType`函数，基于表头匹配度，自动识别文件类型（商智/广告），并提供修正建议。
    2. **数据融合**: 采用“UPSERT”（更新或插入）逻辑，基于主键（如`SKU+日期`）智能合并新旧数据，确保数据不重复且始终最新。
    3. **历史追溯**: 记录每一次上传操作，便于审计与问题排查。

- **数据体验 (`DataExperienceView`)**:
  - **定位**: 系统的“后端控制面板”，赋予用户“上帝视角”。
  - **功能**:
    1. **表结构管理**: 允许用户编辑字段的`label`和`tags`，甚至添加自定义字段。这使得企业可以根据自身独特的Excel表头，轻松配置系统，无需修改任何代码。
    2. **数据预览**: 提供物理表原始数据的预览、搜索和筛选功能，便于数据校验和问题定位。

---

## IV. 业务逻辑流 (Business Logic Flow)

以一次典型的“**分析某SKU为何利润下降**”的场景为例，展示系统内部的数据流与逻辑链：

1.  **数据注入**: 运营人员将最新的“商智明细”和“广告明细”Excel文件，通过「数据中心」上传。
2.  **智能识别与清洗**: 系统自动识别文件类型，根据预设的Schema（表结构），将“成交金额”映射到`paid_amount`字段，将“花费”映射到`cost`字段，并用`normalizeDate`统一日期格式。
3.  **数据融合**: 系统将新数据智能合并到`fact_shangzhi`和`fact_jingzhuntong`物理表中。
4.  **维度关联与计算**: 用户打开「AI利润分析」模块，选择时间范围和目标SKU。
    - 系统从`fact_shangzhi`筛选出该SKU在时间范围内的所有记录，汇总`paid_amount`作为**总收入**。
    - 系统使用`getSkuIdentifier`函数，通过`sku_code`关联到`dim_skus`维度表，获取该SKU的`costPrice`，乘以总销量（`paid_items`），得到**总货品成本**。
    - 系统从`fact_jingzhuntong`筛选出对应记录，汇总`cost`作为**总广告花费**。
    - **净利润 = 总收入 - 总货品成本 - 总广告花费**。
5.  **AI赋能**: 用户点击“AI诊断”。系统将计算出的核心利润指标、Top/Bottom SKU等关键信息，结构化地填入一个精心设计的Prompt模板中。
6.  **价值呈现**: Gemini返回的诊断报告（如“某某SKU因广告ROI过低导致亏损，建议优化其投放策略”）被清晰地展示在前端界面上，为运营人员提供了直接可行的优化建议。

---

## V. 商业化与企业化展望

- **核心卖点 - 数据安全与私有化**:
  完全的客户端架构是面向企业，尤其是中小型企业最有力的卖点。它解决了数据上云的核心焦虑，提供了与私有化部署相媲美的安全性，但成本几乎为零。

- **核心竞争力 - 高度可扩展性**:
  通过开放的“表结构管理”功能，本系统能灵活适应企业现有的、可能“不规范”的数据报表格式。企业无需为了使用工具而改造内部数据流程，极大降低了接入与实施成本。

- **技术护城河 - 深度AI集成**:
  “数舰”不仅仅是集成了AI聊天框，而是将Gemini的能力深度嵌入到每一个分析与创作流程中，构建了“数据 -> 洞察 -> 行动”的AI闭环，这是与传统BI工具的本质区别。

- **未来蓝图 (Roadmap)**:
  当前已为AI竞品监控、AI智能营销官、动态定价引擎、客户生命周期管理等高级模块预留了接口。随着系统的迭代，我们将逐步引入爬虫技术、广告平台API对接、RPA等能力，最终将“数舰”打造为电商运营领域的全能型AI合伙人。
  
  ---
  *文档版本: 2.0*
  *最后更新: [当前日期]*
  *架构师: [您的名字]*